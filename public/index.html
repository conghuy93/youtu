<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube MP3 API Tester</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Segoe UI", system-ui, sans-serif;
    }
    body {
      margin: 0;
      padding: 24px;
      background: #0f172a;
      color: #e2e8f0;
    }
    h1 {
      margin-top: 0;
      font-size: 28px;
    }
    section {
      margin-bottom: 32px;
      background: #1e293b;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.5);
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
    }
    input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #475569;
      background: #0f172a;
      color: #e2e8f0;
      font-size: 16px;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      margin: 6px 6px 6px 0;
      font-size: 14px;
      font-weight: 600;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    button.primary {
      background: linear-gradient(135deg, #06b6d4, #3b82f6);
      color: white;
      box-shadow: 0 10px 20px rgba(59, 130, 246, 0.35);
    }
    button.secondary {
      background: #334155;
      color: #e2e8f0;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.35);
    }
    .results {
      display: grid;
      gap: 16px;
      margin-top: 20px;
    }
    .result-card {
      display: grid;
      gap: 12px;
      padding: 16px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    .result-header {
      display: flex;
      gap: 16px;
    }
    .thumbnail {
      width: 160px;
      height: 90px;
      border-radius: 8px;
      object-fit: cover;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .result-info h3 {
      margin: 0 0 6px;
      font-size: 18px;
    }
    .meta {
      font-size: 14px;
      color: #94a3b8;
    }
    audio {
      width: 100%;
      margin-top: 12px;
    }
    .now-playing {
      font-size: 15px;
      margin-top: 12px;
      color: #fbbf24;
    }
    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .chip {
      background: #0f172a;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    a.link {
      color: #38bdf8;
      text-decoration: none;
    }
    .link:hover {
      text-decoration: underline;
    }
    .status {
      margin-top: 12px;
      font-size: 13px;
      color: #38bdf8;
    }
  </style>
</head>
<body>
  <h1>üéµ YouTube MP3 API Tester</h1>
  <p>Trang test nhanh cho API t·∫°i <code>/api/search</code> v√† <code>/api/stream/mp3</code>. B·∫°n c√≥ th·ªÉ t√¨m b√†i h√°t, ch·ªçn video v√† test c√°c ch·∫ø ƒë·ªô ph√°t (direct URL, proxy, stream).</p>

  <section>
    <label for="search-input">T√¨m b√†i h√°t ho·∫∑c ngh·ªá sƒ©</label>
    <form id="search-form">
      <input id="search-input" type="text" placeholder="V√≠ d·ª•: L·∫°c Tr√¥i, Rick Astley..." required />
      <div style="margin-top:12px;">
        <button class="primary" type="submit">üîç T√¨m ki·∫øm</button>
        <button class="secondary" type="button" id="clear-results">X√≥a k·∫øt qu·∫£</button>
      </div>
    </form>
    <div class="status" id="search-status"></div>
    <div class="results" id="results"></div>
  </section>

  <section>
    <h2>üéß Tr√¨nh ph√°t</h2>
    <audio id="audio-player" controls preload="none"></audio>
    <div class="now-playing" id="now-playing">Ch∆∞a ph√°t b√†i n√†o</div>
    <div class="chips">
      <span class="chip">Proxy: <code>/api/stream/mp3?id=...&format=proxy</code></span>
      <span class="chip">Stream: <code>/api/stream/mp3?id=...&format=stream</code></span>
      <span class="chip">Direct URL: <code>/api/stream/mp3?id=...</code></span>
    </div>
  </section>

  <section>
    <h2>‚öôÔ∏è Quick Test</h2>
    <p>Copy/paste URL v√†o terminal:</p>
    <pre style="white-space: pre-wrap; background:#0f172a; padding:16px; border-radius:12px; border:1px solid rgba(255,255,255,0.05);">
# Direct URL (m·∫∑c ƒë·ªãnh)
curl "<span class="code-host"></span>/api/stream/mp3?id=dQw4w9WgXcQ"

# Proxy (tr√°nh CORS/expire)
curl "<span class="code-host"></span>/api/stream/mp3?id=dQw4w9WgXcQ&format=proxy" -o test.webm

# Stream tr·ª±c ti·∫øp
curl "<span class="code-host"></span>/api/stream/mp3?id=dQw4w9WgXcQ&format=stream" -o test.mp3
    </pre>
  </section>

  <script>
    const apiBase = window.location.origin;
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const resultsEl = document.getElementById('results');
    const statusEl = document.getElementById('search-status');
    const audioPlayer = document.getElementById('audio-player');
    const nowPlayingEl = document.getElementById('now-playing');
    const clearBtn = document.getElementById('clear-results');

    document.querySelectorAll('.code-host').forEach(el => {
      el.textContent = apiBase;
    });

    clearBtn.addEventListener('click', () => {
      resultsEl.innerHTML = '';
      statusEl.textContent = 'ƒê√£ x√≥a k·∫øt qu·∫£.';
    });

    searchForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const query = searchInput.value.trim();
      if (!query) return;

      statusEl.textContent = 'ƒêang t√¨m...';
      resultsEl.innerHTML = '';

      try {
        const resp = await fetch(`${apiBase}/api/search?q=${encodeURIComponent(query)}&limit=10`);
        const data = await resp.json();

        if (!data.success) {
          statusEl.textContent = `L·ªói: ${data.error || 'Kh√¥ng th·ªÉ t√¨m ki·∫øm'}`;
          return;
        }

        if (!data.data || data.data.length === 0) {
          statusEl.textContent = 'Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.';
          return;
        }

        statusEl.textContent = `T√¨m th·∫•y ${data.data.length} k·∫øt qu·∫£.`;
        renderResults(data.data);
      } catch (error) {
        console.error(error);
        statusEl.textContent = `L·ªói khi t√¨m ki·∫øm: ${error.message}`;
      }
    });

    function renderResults(videos) {
      resultsEl.innerHTML = '';

      videos.forEach(video => {
        const card = document.createElement('div');
        card.className = 'result-card';

        card.innerHTML = `
          <div class="result-header">
            <img class="thumbnail" src="${video.thumbnail || ''}" alt="${video.title}" />
            <div class="result-info">
              <h3>${video.title}</h3>
              <div class="meta">Ngh·ªá sƒ©: ${video.channel?.name || video.artist || 'Unknown'}</div>
              <div class="meta">Th·ªùi l∆∞·ª£ng: ${video.duration || 'N/A'} | Views: ${formatNumber(video.views)}</div>
              <div class="meta">Video ID: <code>${video.id}</code></div>
            </div>
          </div>
          <div>
            <button class="primary" data-action="play-proxy" data-id="${video.id}" data-title="${video.title}" data-artist="${video.channel?.name || video.artist || 'Unknown'}">‚ñ∂ Ph√°t (Proxy)</button>
            <button class="secondary" data-action="play-stream" data-id="${video.id}" data-title="${video.title}" data-artist="${video.channel?.name || video.artist || 'Unknown'}">‚ñ∂ Ph√°t (Stream)</button>
            <button class="secondary" data-action="direct-url" data-id="${video.id}">üîó Direct URL</button>
            <a class="link" href="https://www.youtube.com/watch?v=${video.id}" target="_blank" rel="noopener">M·ªü YouTube ‚Üó</a>
          </div>
        `;

        card.addEventListener('click', (event) => handleCardClick(event, video));
        resultsEl.appendChild(card);
      });
    }

    function handleCardClick(event, video) {
      const action = event.target.dataset.action;
      if (!action) return;

      const videoId = event.target.dataset.id;
      const title = event.target.dataset.title;
      const artist = event.target.dataset.artist;

      switch (action) {
        case 'play-proxy':
          playAudio(videoId, 'proxy', title, artist);
          break;
        case 'play-stream':
          playAudio(videoId, 'stream', title, artist);
          break;
        case 'direct-url':
          showDirectUrl(videoId);
          break;
      }
    }

    function playAudio(videoId, mode = 'proxy', title = '', artist = '') {
      const src = mode === 'proxy'
        ? `${apiBase}/api/stream/mp3?id=${videoId}&format=proxy`
        : mode === 'stream'
        ? `${apiBase}/api/stream/mp3?id=${videoId}&format=stream`
        : `${apiBase}/api/stream/mp3?id=${videoId}`;

      audioPlayer.src = src;
      audioPlayer.play().catch(console.error);
      nowPlayingEl.textContent = `ƒêang ph√°t: ${title} ‚Äî ${artist} (${mode})`;
    }

    async function showDirectUrl(videoId) {
      nowPlayingEl.textContent = 'ƒêang l·∫•y direct URL...';
      try {
        const resp = await fetch(`${apiBase}/api/stream/mp3?id=${videoId}`);
        const data = await resp.json();
        if (!data.success) {
          nowPlayingEl.textContent = `Kh√¥ng l·∫•y ƒë∆∞·ª£c direct URL: ${data.error}`;
          return;
        }
        nowPlayingEl.innerHTML = `Direct URL (c√≥ th·ªÉ h·∫øt h·∫°n): <a class="link" href="${data.audio_url}" target="_blank" rel="noopener">M·ªü trong tab m·ªõi</a>`;
      } catch (error) {
        nowPlayingEl.textContent = `L·ªói: ${error.message}`;
      }
    }

    function formatNumber(value) {
      if (!value) return '0';
      return Number(value).toLocaleString('vi-VN');
    }
  </script>
</body>
</html>





